# Project: Multi-Bookie Bet Splitter

## Goal
Build a web application that extracts betting selections from booking codes across multiple bookies (SportyBet, 1xBet, Bet9ja), displays the matches, allows users to split them into multiple tickets, and generates new booking codes.

## Tech Stack
- Frontend: Vue 3 (Composition API) + Vite + Tailwind CSS
- Backend: Node.js + Express (proxy server for CORS)
- No database needed (stateless)

## Discovered API Endpoints

### SportyBet (Confirmed Working)
```
Extract: GET https://www.sportybet.com/api/{region}/orders/share/{bookingCode}
Book:    POST https://www.sportybet.com/api/{region}/orders/share

Regions: ng, ke, gh, tz, ug
Response: XML format (see sample below)
```

### 1xBet (Needs Research)
```
Possible endpoints:
- GET https://1xbet.com/LiveUtil/GetCouponByNumber?number={code}
- GET https://1xbet.com/service-api/coupon/{code}
```

## Sample SportyBet API Response (XML)
```xml
<BaseRsp>
  <bizCode>10000</bizCode>
  <message>Success</message>
  <data>
    <shareCode>TELDTE</shareCode>
    <outcomes>
      <outcomes>
        <eventId>sr:match:61513872</eventId>
        <gameId>29039</gameId>
        <homeTeamName>Heidenheim</homeTeamName>
        <awayTeamName>Bayern Munich</awayTeamName>
        <estimateStartTime>1766334600000</estimateStartTime>
        <sport>
          <name>Football</name>
          <category>
            <name>Germany</name>
            <tournament>
              <name>Bundesliga</name>
            </tournament>
          </category>
        </sport>
        <markets>
          <markets>
            <id>10</id>
            <desc>Double Chance</desc>
            <specifier></specifier>
            <outcomes>
              <outcomes>
                <id>10</id>
                <odds>1.07</odds>
                <desc>Home or Away</desc>
              </outcomes>
            </outcomes>
          </markets>
        </markets>
      </outcomes>
    </outcomes>
  </data>
</BaseRsp>
```

## Required Features

### 1. Extraction Module
- Input: Booking code + Bookie selection + Region (for SportyBet)
- Process: Call bookie API via backend proxy
- Output: Normalized array of matches with: teams, league, date, market, selection, odds

### 2. Match Display
- Show all extracted matches in cards
- Display: Home vs Away, League, Date, Market type, Selection, Odds
- Show total combined odds

### 3. Ticket Splitter
- Settings: Number of tickets, Matches per ticket
- Options: Avoid duplicates across tickets, Balance odds distribution
- Algorithm: Distribute matches across N tickets, optionally alternating high/low odds

### 4. Rebooking
- Generate new booking codes for each split ticket
- Call bookie's booking creation endpoint
- Display generated codes with copy functionality

## Normalized Match Schema
```typescript
interface NormalizedMatch {
  id: string;
  source: 'sportybet' | '1xbet' | 'bet9ja';
  eventId: string;
  gameId: string;
  home: string;
  away: string;
  league: string;
  country: string;
  sport: string;
  date: string;
  timestamp: number;
  market: {
    id: number;
    name: string;
    specifier: string;
  };
  selection: {
    id: number;
    name: string;
    odds: number;
  };
  raw: object; // Original data for rebooking
}
```

## Backend Requirements
- Express server with CORS enabled
- POST /api/extract - Extract matches from booking code
- POST /api/book - Create new booking code
- XML parser for SportyBet responses (use fast-xml-parser)
- Proper error handling and validation

## File Structure
```
├── src/
│   ├── components/
│   │   └── BetSplitter.vue
│   ├── services/
│   │   └── betService.js
│   └── types/
│       └── index.ts
├── server/
│   ├── index.js
│   └── package.json
```

## Implementation Order
1. Backend proxy server with SportyBet extraction
2. Frontend extraction UI and API integration
3. Match display component
4. Splitting algorithm
5. Rebooking functionality
6. Add support for additional bookies

## Important Notes
- Backend proxy is REQUIRED due to CORS restrictions
- SportyBet returns XML, must parse to JSON
- Keep raw response data for rebooking payloads
- Handle both XML and JSON response formats
- Add loading states and error handling
```

---

## Tips for Better AI Results

**1. Break it into phases:**
```
"First, let's build just the backend proxy for SportyBet extraction. 
Here's the API endpoint and sample response..."
```

**2. Provide concrete examples:**
```
"When I call GET /api/ng/orders/share/TELDTE, I get this response: [paste XML]
Parse this and return normalized JSON."
```

**3. Ask for specific files:**
```
"Create server/index.js with Express that:
1. Has POST /api/extract endpoint
2. Accepts {bookingCode, bookie, region}
3. Calls SportyBet API
4. Parses XML response
5. Returns normalized matches"
```

**4. Iterate with feedback:**
```
"The extraction works. Now add the splitting algorithm that:
- Takes array of matches
- Splits into N tickets with M matches each
- Balances odds across tickets"